<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø¬Ø² Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¹Ù„ÙˆÙ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
    body { margin:0; background:#f2f6fb; color:#333; }
    header { background:#0d6efd; color:#fff; padding:16px; text-align:center; font-size:20px; font-weight:700; }
    .container { max-width:900px; margin:auto; padding:16px; }
    .card { background:#fff; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
    h2 { margin-top:0; font-size:18px; border-bottom:1px solid #eee; padding-bottom:8px; }
    label { font-weight:600; margin-top:10px; display:block; }
    input,select,textarea { width:100%; padding:10px; margin-top:4px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
    textarea{ resize:vertical; }
    .buttons{ display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; }
    button{ flex:1; padding:12px; border:none; border-radius:10px; font-size:15px; cursor:pointer; font-weight:600; }
    .add{ background:#198754; color:#fff; }
    .edit{ background:#ffc107; }
    .delete{ background:#dc3545; color:#fff; }
    .bookings{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; }
    .booking{ background:#f8f9fa; padding:12px; border-radius:10px; border-right:5px solid #0d6efd; cursor:pointer; }
    .toast{ position:fixed; bottom:20px; right:20px; background:#198754; color:#fff; padding:12px 18px; border-radius:10px; opacity:0; transform:translateY(20px); transition:.3s; z-index:1000; }
    .toast.show{ opacity:1; transform:translateY(0); }
  </style>
</head>

<body>

<header>ğŸ§ª Ø­Ø¬Ø² Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¹Ù„ÙˆÙ…</header>

<div class="container">

<div class="card">
<h2>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²</h2>
<input type="hidden" id="bookingId">

<label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
<input type="date" id="date">

<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label>
<select id="teacher">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…</option>
<option>Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯ÙŠ</option>
<option>Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ¯ÙŠ</option>
<option>ÙŠØ¹Ù‚ÙˆØ¨ Ø§Ù„Ø³Ù†Ø§Ù†ÙŠ</option>
<option>ÙŠÙˆØ³Ù Ø§Ù„Ø±Ø¨ÙŠØ¹ÙŠ</option>
<option>Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø¯ÙŠ</option>
</select>

<label>Ø§Ù„Ø­ØµØ©</label>
<select id="period">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­ØµØ©</option>
<option>Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option><option>Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
<option>Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option><option>Ø§Ù„Ø®Ø§Ù…Ø³Ø©</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³Ø©</option>
<option>Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©</option><option>Ø§Ù„Ø«Ø§Ù…Ù†Ø©</option>
</select>

<label>Ø§Ù„ØµÙ</label>
<input id="classroom">

<label>Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ø­Ø¬Ø²</label>
<textarea id="purpose"></textarea>

<div class="buttons">
<button class="add" onclick="addBooking()">Ø­Ø¬Ø² Ø§Ù„Ù…Ø®ØªØ¨Ø±</button>
<button class="edit" onclick="updateBooking()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</button>
<button class="delete" onclick="deleteBooking()">Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²</button>
</div>
</div>

<div class="card">
<h2>Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ… (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù…Ùƒ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</h2>
<div class="bookings" id="bookings"></div>
</div>

</div>

<div class="toast" id="toast"></div>
<audio id="sound">
<source src="https://actions.google.com/sounds/v1/notifications/notification_simple-01.mp3">
</audio>

<script>
const API="https://script.google.com/macros/s/AKfycby_fbgm9DweHvibXTAP7_YbZxvjVL0INFWd80oGJf6fJYxGPvkxIK1dBnHjw4WDdPA0sg/exec";

const $=id=>document.getElementById(id);

function showToast(msg,ok=true){
  const t=$("toast");
  t.textContent=msg;
  t.style.background=ok?"#198754":"#dc3545";
  t.classList.add("show");
  $("sound").play();
  setTimeout(()=>t.classList.remove("show"),3000);
}

function today(){
  return new Date().toISOString().split("T")[0];
}

function formData(extra={}){
  return new URLSearchParams({
    date: $("date").value,
    teacher:$("teacher").value,
    period:$("period").value,
    classroom:$("classroom").value,
    purpose:$("purpose").value,
    ...extra
  });
}

function addBooking(){
fetch(API,{method:"POST",body:formData({action:"add"})})
.then(r=>r.json()).then(d=>{showToast(d.message,d.success);loadToday();});
}

function updateBooking(){
if(!$("bookingId").value) return showToast("Ø§Ø®ØªØ± Ø­Ø¬Ø²Ù‹Ø§ Ø£ÙˆÙ„Ù‹Ø§",false);
fetch(API,{method:"POST",body:formData({action:"update",id:$("bookingId").value})})
.then(r=>r.json()).then(d=>{showToast(d.message,d.success);loadToday();});
}

function deleteBooking(){
if(!$("bookingId").value) return showToast("Ø§Ø®ØªØ± Ø­Ø¬Ø²Ù‹Ø§ Ø£ÙˆÙ„Ù‹Ø§",false);
fetch(API,{method:"POST",body:new URLSearchParams({action:"delete",id:$("bookingId").value})})
.then(r=>r.json()).then(d=>{showToast(d.message,d.success);loadToday();});
}

function loadToday(){
fetch(API,{method:"POST",body:new URLSearchParams({action:"getToday",date:today()})})
.then(r=>r.json()).then(d=>{
  const box=$("bookings");
  box.innerHTML="";
  if(!d.bookings || !d.bookings.length){
    box.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>";
    return;
  }
  d.bookings.forEach(b=>{
    const div=document.createElement("div");
    div.className="booking";
    div.innerHTML=`
      <strong>${b.period}</strong><br>
      Ø§Ù„ØµÙ: ${b.classroom}<br>
      Ø§Ù„Ù…Ø¹Ù„Ù…: <b>${b.teacher}</b><br>
      ${b.purpose}
    `;
    div.onclick=()=>{
      $("bookingId").value=b.id;
      $("date").value=b.date;
      $("teacher").value=b.teacher;
      $("period").value=b.period;
      $("classroom").value=b.classroom;
      $("purpose").value=b.purpose;
    };
    box.appendChild(div);
  });
});
}

$("date").value=today();
loadToday();
</script>

</body>
</html>
